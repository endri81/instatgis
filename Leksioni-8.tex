% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  ignorenonframetext,
]{beamer}
\usepackage{pgfpages}
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}{: }
\setbeamercolor{caption name}{fg=normal text.fg}
\beamertemplatenavigationsymbolsempty
% Prevent slide breaks in the middle of a paragraph
\widowpenalties 1 10000
\raggedbottom
\setbeamertemplate{part page}{
  \centering
  \begin{beamercolorbox}[sep=16pt,center]{part title}
    \usebeamerfont{part title}\insertpart\par
  \end{beamercolorbox}
}
\setbeamertemplate{section page}{
  \centering
  \begin{beamercolorbox}[sep=12pt,center]{part title}
    \usebeamerfont{section title}\insertsection\par
  \end{beamercolorbox}
}
\setbeamertemplate{subsection page}{
  \centering
  \begin{beamercolorbox}[sep=8pt,center]{part title}
    \usebeamerfont{subsection title}\insertsubsection\par
  \end{beamercolorbox}
}
\AtBeginPart{
  \frame{\partpage}
}
\AtBeginSection{
  \ifbibliography
  \else
    \frame{\sectionpage}
  \fi
}
\AtBeginSubsection{
  \frame{\subsectionpage}
}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\usetheme[]{Madrid}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\newif\ifbibliography
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\logo{\includegraphics[height=1cm,width=3cm]{logo.png}}
\usetheme{Madrid}
\usefonttheme{serif}
\setbeamertemplate{navigation symbols}{}
\usepackage{lmodern}  % for bold teletype font
\usepackage{amsmath}  % for \hookrightarrow
\usepackage{xcolor}   % for \textcolor


\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Leksioni 5},
  pdfauthor={Endri Raco},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Leksioni 5}
\author{Endri Raco}
\date{05 May, 2024}

\begin{document}
\frame{\titlepage}

\begin{frame}[allowframebreaks]
  \tableofcontents[hideallsubsections]
\end{frame}
\hypertarget{tuxeb-dhuxebnat-raster-vazhdim}{%
\section{Të dhënat Raster
(vazhdim)}\label{tuxeb-dhuxebnat-raster-vazhdim}}

\begin{frame}[fragile]{Analiza e Pikave dhe Vlerësimi i Dendësisë së
Kernelit (KDE)}
\protect\hypertarget{analiza-e-pikave-dhe-vleruxebsimi-i-denduxebsisuxeb-suxeb-kernelit-kde}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ urllib.request}

\CommentTok{\# Shkarkoni të dhënat e anijeve të mbytura historike}
\NormalTok{url\_shipwrecks }\OperatorTok{=} \StringTok{\textquotesingle{}https://github.com/endri81/instatgis/blob/master/data/gis4/darmc\_historical\_shipwrecks\_500bce\_1500ce.geojson?raw=true\textquotesingle{}}
\NormalTok{file\_name\_shipwrecks }\OperatorTok{=} \StringTok{\textquotesingle{}data/darmc\_historical\_shipwrecks\_500bce\_1500ce.geojson\textquotesingle{}}
\NormalTok{urllib.request.urlretrieve(url\_shipwrecks, file\_name\_shipwrecks)}

\CommentTok{\# Shkarkoni gjithashtu kufijtë e vendeve}
\NormalTok{url\_boundaries }\OperatorTok{=} \StringTok{\textquotesingle{}https://github.com/endri81/instatgis/blob/master/data/gis4/natural\_earth\_world\_boundaries\_50m\_2018.geojson?raw=true\textquotesingle{}}
\NormalTok{file\_name\_boundaries }\OperatorTok{=} \StringTok{\textquotesingle{}data/natural\_earth\_world\_boundaries\_50m\_2018.geojson\textquotesingle{}}
\NormalTok{urllib.request.urlretrieve(url\_boundaries, file\_name\_boundaries)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Ngarkimi dhe Projekti i Dataset-eve}
\protect\hypertarget{ngarkimi-dhe-projekti-i-dataset-eve}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ geopandas }\ImportTok{as}\NormalTok{ gpd}

\CommentTok{\# Ngarkoni dataset{-}in dhe projektoni në 3035 (Lambert, i përshtatshëm për Evropën)}
\NormalTok{ship\_df }\OperatorTok{=}\NormalTok{ gpd.read\_file(}\StringTok{\textquotesingle{}data/darmc\_historical\_shipwrecks\_500bce\_1500ce.geojson\textquotesingle{}}\NormalTok{).to\_crs(}\DecValTok{3035}\NormalTok{)}
\NormalTok{countries\_df }\OperatorTok{=}\NormalTok{ gpd.read\_file(}\StringTok{\textquotesingle{}data/natural\_earth\_world\_boundaries\_50m\_2018.geojson\textquotesingle{}}\NormalTok{).to\_crs(}\DecValTok{3035}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Shfaqni një shembull të të dhënave}
\protect\hypertarget{shfaqni-njuxeb-shembull-tuxeb-tuxeb-dhuxebnave}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ship\_df.sample(}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Shfaqni një shembull të të dhënave}
\protect\hypertarget{shfaqni-njuxeb-shembull-tuxeb-tuxeb-dhuxebnave-1}{}
\includegraphics{./Figs/ship.png}
\end{frame}

\begin{frame}[fragile]{Vizualizimi i Pikave}
\protect\hypertarget{vizualizimi-i-pikave}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ geoplot}
\ImportTok{import}\NormalTok{ matplotlib.pyplot }\ImportTok{as}\NormalTok{ plt}

\CommentTok{\# Përkufizoni kanavacën}
\NormalTok{f, ax }\OperatorTok{=}\NormalTok{ plt.subplots(figsize}\OperatorTok{=}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{7}\NormalTok{))}

\CommentTok{\# Vizualizoni dy shtresa}
\NormalTok{countries\_df.plot(ax}\OperatorTok{=}\NormalTok{ax, color}\OperatorTok{=}\StringTok{\textquotesingle{}lightgray\textquotesingle{}}\NormalTok{, edgecolor}\OperatorTok{=}\StringTok{"none"}\NormalTok{, linewidth}\OperatorTok{=}\FloatTok{.5}\NormalTok{)}
\NormalTok{geoplot.pointplot(ship\_df, s}\OperatorTok{=}\DecValTok{2}\NormalTok{, color}\OperatorTok{=}\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{, ax}\OperatorTok{=}\NormalTok{ax, alpha}\OperatorTok{=}\FloatTok{.1}\NormalTok{)}

\CommentTok{\# Vendosni kufijtë e hartës}
\CommentTok{\# Krijoni një buffer për të shtuar një margjinë}
\NormalTok{buff }\OperatorTok{=}\NormalTok{ ship\_df.}\BuiltInTok{buffer}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{xlim }\OperatorTok{=}\NormalTok{ ([buff.total\_bounds[}\DecValTok{0}\NormalTok{], buff.total\_bounds[}\DecValTok{2}\NormalTok{]])}
\NormalTok{ylim }\OperatorTok{=}\NormalTok{ ([buff.total\_bounds[}\DecValTok{1}\NormalTok{], buff.total\_bounds[}\DecValTok{3}\NormalTok{]])}
\NormalTok{ax.set\_xlim(xlim)}
\NormalTok{ax.set\_ylim(ylim)}

\CommentTok{\# Vendosni titullin e hartës}
\NormalTok{ax.set\_title(}\StringTok{\textquotesingle{}Anije të Mbytura (500 p.e.s. {-} 1500 e.s.)\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Shfaqni rezultatet}
\NormalTok{plt.show()}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Vizualizimi i Pikave}
\protect\hypertarget{vizualizimi-i-pikave-1}{}
\includegraphics{./Figs/anije.png}
\end{frame}

\begin{frame}{Histogram 2D}
\protect\hypertarget{histogram-2d}{}
\begin{itemize}
\tightlist
\item
  Një mënyrë më e mirë për të përfaqësuar një densitet hapësinor është
  një histogram dy-dimensional (hist2d), i njohur gjithashtu si një
  grafik rrjeti.
\end{itemize}
\end{frame}

\begin{frame}{Histogram 2D}
\protect\hypertarget{histogram-2d-1}{}
\begin{itemize}
\tightlist
\item
  Vini re se një nga avantazhet e Python është mundësia e ndryshimit të
  parametrave të një funksioni përmes një cikli for (për shembull, numri
  i shtyllave në një histogram) dhe krahasimi i rezultateve.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Histogram 2D}
\protect\hypertarget{histogram-2d-2}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# riprojektojmë në lon/lat për të pasur koordinata më të interpretueshme}
\NormalTok{ship\_df }\OperatorTok{=}\NormalTok{ ship\_df.to\_crs(}\DecValTok{4326}\NormalTok{)}

\CommentTok{\# le të luajmë me numrin e bins:}
\ControlFlowTok{for}\NormalTok{ bin\_n }\KeywordTok{in}\NormalTok{ [}\DecValTok{10}\NormalTok{,}\DecValTok{20}\NormalTok{,}\DecValTok{30}\NormalTok{,}\DecValTok{40}\NormalTok{]:}
    \BuiltInTok{print}\NormalTok{(}\StringTok{"bin\_n"}\NormalTok{,bin\_n)}
\NormalTok{    h }\OperatorTok{=}\NormalTok{ plt.hist2d(ship\_df.geometry.x, ship\_df.geometry.y, bins}\OperatorTok{=}\NormalTok{bin\_n, density}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{    plt.colorbar(h[}\DecValTok{3}\NormalTok{])}
\NormalTok{    plt.title(}\StringTok{\textquotesingle{}2D histograma e anijeve (bins=\textquotesingle{}}\OperatorTok{+}\BuiltInTok{str}\NormalTok{(bin\_n)}\OperatorTok{+}\StringTok{")"}\NormalTok{)}
\NormalTok{    plt.show()}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Histogram 2D}
\protect\hypertarget{histogram-2d-3}{}
Këto grafikë tregojnë praninë e një zone me densitet jashtëzakonisht të
lartë midis Francës, Korsikës dhe Italisë:
\end{frame}

\begin{frame}{Grafiku KDE}
\protect\hypertarget{grafiku-kde}{}
\begin{itemize}
\item
  Një qasje më shkencore është vlerësimi i densitetit të bërthamës
  (KDE).
\item
  \textbf{geoplot.kdeplot(\ldots)} mund të vizatojë një KDE duke u nisur
  nga të dhënat e pikës.
\end{itemize}
\end{frame}

\begin{frame}{Grafiku KDE}
\protect\hypertarget{grafiku-kde-1}{}
\begin{itemize}
\tightlist
\item
  Një parametër vendimtar është \textbf{bandwidth} (bw), që është pragu
  i distancës që përdoret për të prodhuar sipërfaqen (distancat më të
  shkurtra rezultojnë në një sipërfaqe më të detajuar):
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Grafiku KDE}
\protect\hypertarget{grafiku-kde-2}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# transformojmë në lon/lat}
\NormalTok{ship\_df\_ll }\OperatorTok{=}\NormalTok{ ship\_df.to\_crs(}\DecValTok{4326}\NormalTok{)}

\CommentTok{\# gjenerojmë KDE me bandwidth të ndryshëm}
\ControlFlowTok{for}\NormalTok{ bandwidth }\KeywordTok{in}\NormalTok{ [}\FloatTok{.1}\NormalTok{, }\FloatTok{.2}\NormalTok{, }\FloatTok{.3}\NormalTok{, }\FloatTok{.4}\NormalTok{]:}
    \BuiltInTok{print}\NormalTok{(}\StringTok{"bandwidth:"}\NormalTok{,bandwidth)}
    \CommentTok{\# konturet e KDE}
\NormalTok{    ax }\OperatorTok{=}\NormalTok{ geoplot.kdeplot(ship\_df\_ll, shade}\OperatorTok{=}\VariableTok{False}\NormalTok{, bw}\OperatorTok{=}\NormalTok{bandwidth, figsize}\OperatorTok{=}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{12}\NormalTok{), alpha}\OperatorTok{=}\FloatTok{.5}\NormalTok{)}
    \CommentTok{\# shtojmë vijën bregdetare}
\NormalTok{    countries\_df.to\_crs(}\DecValTok{4326}\NormalTok{).plot(ax}\OperatorTok{=}\NormalTok{ax, color}\OperatorTok{=}\StringTok{\textquotesingle{}lightgray\textquotesingle{}}\NormalTok{, edgecolor}\OperatorTok{=}\StringTok{"none"}\NormalTok{, linewidth}\OperatorTok{=}\FloatTok{.5}\NormalTok{)}
    \CommentTok{\# shtojmë titull}
\NormalTok{    plt.title(}\StringTok{\textquotesingle{}Dendësia e mbytjeve të anijeve (KDE, bw=\textquotesingle{}}\OperatorTok{+}\BuiltInTok{str}\NormalTok{(bandwidth)}\OperatorTok{+}\StringTok{")"}\NormalTok{, fontsize}\OperatorTok{=}\DecValTok{18}\NormalTok{)}
    \CommentTok{\# figura}
\NormalTok{    plt.show()}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Grafiku KDE}
\protect\hypertarget{grafiku-kde-3}{}
\includegraphics{./Figs/kde.png}
\end{frame}

\begin{frame}{Analiza e të dhënave}
\protect\hypertarget{analiza-e-tuxeb-dhuxebnave}{}
\begin{itemize}
\item
  Këta grafikë KDE tregojnë se dataset-i ka një përqendrim shumë të
  lartë të pikave në Detin Mesdhe, midis Francës Jugore, Korsikës dhe
  Bregut Perëndimor të Italisë.
\item
  Në të gjitha grafikët, kjo qendër graviteti shfaqet qartë.
\end{itemize}
\end{frame}

\begin{frame}{Analiza e të dhënave}
\protect\hypertarget{analiza-e-tuxeb-dhuxebnave-1}{}
\begin{itemize}
\tightlist
\item
  Në aspektin shkencor, kjo mund të tregojë se kishte shumë më tepër
  mbytje anijesh aty se gjetkë, ose (më e mundshme) që të dhënat
  historike janë më të pasura dhe më të hollësishme për atë zonë.
\end{itemize}
\end{frame}

\hypertarget{algjebra-e-hartave}{%
\section{Algjebra e Hartave}\label{algjebra-e-hartave}}

\begin{frame}{Algjebra e Hartave}
\protect\hypertarget{algjebra-e-hartave-1}{}
\begin{itemize}
\item
  Termi ``algjebra e hartave'' i referohet idesë së aplikimit të
  operacioneve algjebrike në dataset-e raster.
\item
  Për shembull, mund të dëshirojmë të zbresim nga njëri- tjetri dy
  rastera të temperaturës të kapur në kohë të ndryshme për të vëzhguar
  ndryshimin e temperaturës:
\end{itemize}
\end{frame}

\begin{frame}{Algjebra e Hartave}
\protect\hypertarget{algjebra-e-hartave-2}{}
\includegraphics{./Figs/map_algebra1.png}
\end{frame}

\begin{frame}{Algjebra e Hartave}
\protect\hypertarget{algjebra-e-hartave-3}{}
Në praktikë, ky është një operacion aritmetik i aplikuar në çdo qelizë
të të dy raster-ve:

\includegraphics{./Figs/map_algebra2.png}
\end{frame}

\begin{frame}{Algjebra e hartave në Python}
\protect\hypertarget{algjebra-e-hartave-nuxeb-python}{}
\begin{itemize}
\item
  Kur aksesojmë raster me \textbf{rasterio} ose \textbf{gdal}, ne mund
  të kryejmë çdo lloj llogaritjeje algjebrike lineare mbi të dhënat duke
  përdorur \textbf{numpy, scipy} dhe shumë paketa të tjera të fuqishme
  të Python.
\item
  Statistikat zonale suportohen në librarinë \textbf{rasterstats}.
\end{itemize}
\end{frame}

\begin{frame}{Algjebra e hartave në Python}
\protect\hypertarget{algjebra-e-hartave-nuxeb-python-1}{}
\begin{itemize}
\tightlist
\item
  Kjo është arsyeja kryesore pse Python përdoret gjerësisht në
  komunitetet e remote sensing, machine learning, dhe AI.
\end{itemize}
\end{frame}

\begin{frame}{Ngarkoni të dhënat e temperaturës}
\protect\hypertarget{ngarkoni-tuxeb-dhuxebnat-e-temperaturuxebs}{}
\begin{itemize}
\tightlist
\item
  Si një shembull, le të shkarkojmë dhe vizualizojmë dy datasete raster
  që përfaqësojnë temperaturën mesatare në vitin 2000 dhe 2017.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Ngarkoni të dhënat e temperaturës}
\protect\hypertarget{ngarkoni-tuxeb-dhuxebnat-e-temperaturuxebs-1}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ urllib.request}

\CommentTok{\# Define new URLs and file names}
\NormalTok{url\_2000 }\OperatorTok{=} \StringTok{"https://github.com/endri81/instatgis/blob/master/data/gis4/air\_temp\_2000{-}average.tif?raw=true"}
\NormalTok{url\_2017 }\OperatorTok{=} \StringTok{"https://github.com/endri81/instatgis/blob/master/data/gis4/air\_temp\_2017{-}average.tif?raw=true"}
\NormalTok{file\_name\_2000 }\OperatorTok{=} \StringTok{\textquotesingle{}data/air\_temp\_2000{-}average.tif\textquotesingle{}}
\NormalTok{file\_name\_2017 }\OperatorTok{=} \StringTok{\textquotesingle{}data/air\_temp\_2017{-}average.tif\textquotesingle{}}

\CommentTok{\# Download the files}
\NormalTok{urllib.request.urlretrieve(url\_2000, file\_name\_2000)}
\NormalTok{urllib.request.urlretrieve(url\_2017, file\_name\_2017)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Ngarkoni të dhënat e temperaturës}
\protect\hypertarget{ngarkoni-tuxeb-dhuxebnat-e-temperaturuxebs-2}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{temp00 }\OperatorTok{=}\NormalTok{ rasterio.}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}data/air\_temp\_2000{-}average.tif\textquotesingle{}}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(temp00.meta)}
\NormalTok{temp17 }\OperatorTok{=}\NormalTok{ rasterio.}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}data/air\_temp\_2017{-}average.tif\textquotesingle{}}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(temp17.meta)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Ngarkoni të dhënat e temperaturës}
\protect\hypertarget{ngarkoni-tuxeb-dhuxebnat-e-temperaturuxebs-3}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ matplotlib.pyplot }\ImportTok{as}\NormalTok{ plt}
\ImportTok{import}\NormalTok{ rasterio}
\ImportTok{from}\NormalTok{ matplotlib.colors }\ImportTok{import}\NormalTok{ TwoSlopeNorm}
\CommentTok{\# Vini re diverge\_zero: kjo përdoret sepse temperatura në Celsius mund të vizualizohet si diverguese nga zero}
\NormalTok{plot\_raster(temp00, temp00.read(}\DecValTok{1}\NormalTok{, masked}\OperatorTok{=}\VariableTok{True}\NormalTok{), }\StringTok{\textquotesingle{}Temperatura mesatare e ajrit (2000)\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Temperatura mesatare (C)\textquotesingle{}}\NormalTok{, }
    \StringTok{\textquotesingle{}RdYlBu\_r\textquotesingle{}}\NormalTok{, diverge\_zero}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\NormalTok{plot\_raster(temp17, temp17.read(}\DecValTok{1}\NormalTok{, masked}\OperatorTok{=}\VariableTok{True}\NormalTok{), }\StringTok{\textquotesingle{}Temperatura mesatare e ajrit (2017)\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Temperatura mesatare (C)\textquotesingle{}}\NormalTok{, }
    \StringTok{\textquotesingle{}RdYlBu\_r\textquotesingle{}}\NormalTok{, diverge\_zero}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Ngarkoni të dhënat e temperaturës}
\protect\hypertarget{ngarkoni-tuxeb-dhuxebnat-e-temperaturuxebs-4}{}
\includegraphics{./Figs/temp200.png}
\end{frame}

\begin{frame}{Krahasimi i të dhënave raster}
\protect\hypertarget{krahasimi-i-tuxeb-dhuxebnave-raster}{}
\begin{itemize}
\item
  Vizualisht, nuk është e mundur të dallohen ndryshimet midis të dhënave
  të vitit 2000 dhe atyre të vitit 2017.
\item
  Prandaj, do të zbresim dy rasterat e temperaturës, duke përdorur
  Algjebrën e Hartave.
\end{itemize}
\end{frame}

\begin{frame}{Krahasimi i të dhënave raster}
\protect\hypertarget{krahasimi-i-tuxeb-dhuxebnave-raster-1}{}
\begin{itemize}
\item
  Në praktikë, Python lejon të bëhet kjo në mënyrë intuitive si
  \textbf{raster\_vals2 - raster\_vals1}.
\item
  Këto janë operacione algjebrike lineare të aplikuara në çdo qelizë të
  matricave.
\end{itemize}
\end{frame}

\begin{frame}{Krahasimi i të dhënave raster}
\protect\hypertarget{krahasimi-i-tuxeb-dhuxebnave-raster-2}{}
\begin{itemize}
\tightlist
\item
  Pastaj do të ndërtojmë një histogram të vlerave dhe raster-it, duke
  treguar se temperaturat mesatare janë më të larta me 0.5 gradë, me
  disa raste ekstreme pozitive dhe negative që mund të shkaktohen nga
  gabimet e sensorëve.
\end{itemize}
\end{frame}

\begin{frame}{Krahasimi i të dhënave raster}
\protect\hypertarget{krahasimi-i-tuxeb-dhuxebnave-raster-3}{}
Rezultati do të ruhet në një skedar të ri raster, duke ripërdorur
metadatat nga raster-at hyrës.
\end{frame}

\begin{frame}[fragile]{Krahasimi i të dhënave raster}
\protect\hypertarget{krahasimi-i-tuxeb-dhuxebnave-raster-4}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vals17 }\OperatorTok{=}\NormalTok{ temp17.read(}\DecValTok{1}\NormalTok{, masked}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\NormalTok{vals00 }\OperatorTok{=}\NormalTok{ temp00.read(}\DecValTok{1}\NormalTok{, masked}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Krahasimi i të dhënave raster}
\protect\hypertarget{krahasimi-i-tuxeb-dhuxebnave-raster-5}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# zbresim të dy raster{-}at}
\NormalTok{vals\_diff }\OperatorTok{=}\NormalTok{ vals17 }\OperatorTok{{-}}\NormalTok{ vals00}
\BuiltInTok{print}\NormalTok{(}\StringTok{"Statistikat e Diferencës:"}\NormalTok{, vals\_diff.}\BuiltInTok{min}\NormalTok{(), }\BuiltInTok{round}\NormalTok{(vals\_diff.mean(), }\DecValTok{2}\NormalTok{), vals\_diff.}\BuiltInTok{max}\NormalTok{())}
\BuiltInTok{print}\NormalTok{(}\StringTok{"Diferenca midis mesatareve:"}\NormalTok{, }\BuiltInTok{round}\NormalTok{(vals17.mean()}\OperatorTok{{-}}\NormalTok{vals00.mean(), }\DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Krahasimi i të dhënave raster}
\protect\hypertarget{krahasimi-i-tuxeb-dhuxebnave-raster-6}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# vizatoni histogramin}
\NormalTok{show\_hist(vals\_diff, bins}\OperatorTok{=}\DecValTok{30}\NormalTok{, lw}\OperatorTok{=}\FloatTok{0.2}\NormalTok{, stacked}\OperatorTok{=}\VariableTok{False}\NormalTok{, alpha}\OperatorTok{=}\FloatTok{0.8}\NormalTok{, label}\OperatorTok{=}\StringTok{\textquotesingle{}Nr i qelizave\textquotesingle{}}\NormalTok{,}
\NormalTok{    histtype}\OperatorTok{=}\StringTok{\textquotesingle{}stepfilled\textquotesingle{}}\NormalTok{, title}\OperatorTok{=}\StringTok{"Dallimi në temperaturën mesatare (2000{-}2017)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Krahasimi i të dhënave raster}
\protect\hypertarget{krahasimi-i-tuxeb-dhuxebnave-raster-7}{}
\includegraphics{./Figs/temphist.png}
\end{frame}

\begin{frame}{Ndërtojmë rasterin}
\protect\hypertarget{nduxebrtojmuxeb-rasterin}{}
\begin{itemize}
\tightlist
\item
  Cmap (Purple - White - Orange) thekson vlerat ekstreme, duke fshehur
  zonat ku vlerat nuk divergojnë.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Ndërtojmë rasterin}
\protect\hypertarget{nduxebrtojmuxeb-rasterin-1}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plot\_raster(temp17, vals\_diff, }\StringTok{\textquotesingle{}Ndryshimi mesatar i temperaturës së ajrit 2000{-}2017\textquotesingle{}}\NormalTok{,}
            \StringTok{\textquotesingle{}Diferenca e temperaturës (C)\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}PuOr\_r\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Ndërtojmë rasterin}
\protect\hypertarget{nduxebrtojmuxeb-rasterin-2}{}
\includegraphics{./Figs/tempdif.png}
\end{frame}

\begin{frame}{Ruani rezultatin në një skedar raster}
\protect\hypertarget{ruani-rezultatin-nuxeb-njuxeb-skedar-raster}{}
\begin{itemize}
\tightlist
\item
  Është e rëndësishme të specifikohen metadatat nga skedarët hyrës,
  përfshirë CRS, vlerën NODATA dhe transformimin e koordinatave
  gjeografike:
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Ruani rezultatin në një skedar raster}
\protect\hypertarget{ruani-rezultatin-nuxeb-njuxeb-skedar-raster-1}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fout }\OperatorTok{=} \StringTok{\textquotesingle{}tmp/air\_temp\_diff\_2000\_2017.tif\textquotesingle{}}
\NormalTok{ds }\OperatorTok{=}\NormalTok{ rasterio.}\BuiltInTok{open}\NormalTok{(fout, }\StringTok{\textquotesingle{}w\textquotesingle{}}\NormalTok{,}
\NormalTok{    driver}\OperatorTok{=}\StringTok{\textquotesingle{}GTiff\textquotesingle{}}\NormalTok{, }\CommentTok{\# formati i skedarit të daljes}
\NormalTok{    height}\OperatorTok{=}\NormalTok{vals\_diff.shape[}\DecValTok{0}\NormalTok{], }\CommentTok{\# madhësia e matricës}
\NormalTok{    width}\OperatorTok{=}\NormalTok{vals\_diff.shape[}\DecValTok{1}\NormalTok{], }\CommentTok{\# madhësia e matricës}
\NormalTok{    count}\OperatorTok{=}\DecValTok{1}\NormalTok{, }\CommentTok{\# numri i bandave}
\NormalTok{    dtype}\OperatorTok{=}\NormalTok{vals\_diff.dtype, }\CommentTok{\# lloji i të dhënave (p.sh., pikë lundruese)}
\NormalTok{    crs}\OperatorTok{=}\NormalTok{temp17.crs, }\CommentTok{\# CRS (p.sh., Lambert, WGS84, UTM, etj.)}
\NormalTok{    nodata}\OperatorTok{=}\NormalTok{temp17.nodata, }\CommentTok{\# vlera e përdorur për të përfaqësuar NO DATA}
\NormalTok{    transform}\OperatorTok{=}\NormalTok{temp17.transform }\CommentTok{\# transformimi i koordinatave gjeografike}
\NormalTok{)}

\NormalTok{ds.write(vals\_diff, }\DecValTok{1}\NormalTok{)}
\NormalTok{ds.close()}
\BuiltInTok{print}\NormalTok{(}\StringTok{"Raster u ruajt te"}\NormalTok{, fout, }\StringTok{\textquotesingle{}.\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Statistikat zonale}
\protect\hypertarget{statistikat-zonale}{}
\begin{itemize}
\item
  Kur dëshirojmë të llogarisim statistikat raster bazuar në një zonë
  gjeografike, na duhen \textbf{statistikat zonale}.
\item
  Për shembull, mund të dëshirojmë të llogarisim lartësinë mesatare
  (vlerat) e çdo rrethi (zonave) në Angli.
\end{itemize}
\end{frame}

\begin{frame}{Statistikat zonale}
\protect\hypertarget{statistikat-zonale-1}{}
\begin{itemize}
\tightlist
\item
  Si skedar \textbf{input}, statistikat zonale kanë nevojë për një
  raster që përfaqëson vlerat dhe një grup tjetër të dhënash që
  përfaqëson zonat për të cilat duam të llogarisim statistikat:
\end{itemize}
\end{frame}

\begin{frame}{Statistikat zonale}
\protect\hypertarget{statistikat-zonale-2}{}
\includegraphics{./Figs/zonal1.png} \#\# Statistikat zonale

\begin{itemize}
\tightlist
\item
  Në këtë shembull, ne do të përdorim të dhënat evropiane të NOx të
  përdorura më sipër si vlera dhe zonat statistikore evropiane (NUTS) si
  zona.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Shkarkojmë datat}
\protect\hypertarget{shkarkojmuxeb-datat}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# shkarkoni kufijtë rajonalë të BE{-}së (niveli NUTS 2, 2021)}
\NormalTok{nuts2\_file }\OperatorTok{=} \StringTok{\textquotesingle{}data/NUTS\_RG\_01M\_2021\_4326\_LEVL\_2.geojson.gz\textquotesingle{}}
\NormalTok{url }\OperatorTok{=} \StringTok{\textquotesingle{}https://raw.githubusercontent.com/endri81/instatgis/master/data/gis4/NUTS\_RG\_01M\_2021\_4326\_LEVL\_2.geojson.gz\textquotesingle{}}
\NormalTok{urllib.request.urlretrieve(url, nuts2\_file)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Shkarkojmë datat}
\protect\hypertarget{shkarkojmuxeb-datat-1}{}
Skedari është gzip dhe mund ta hapim direkt me
\textbf{gzip.open(\ldots)}

\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ geopandas }\ImportTok{as}\NormalTok{ gpd}
\ImportTok{import}\NormalTok{ gzip}
\NormalTok{nuts2\_df }\OperatorTok{=}\NormalTok{ gpd.read\_file(gzip.}\BuiltInTok{open}\NormalTok{(nuts2\_file))}
\NormalTok{nuts2\_df.plot()}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Shkarkojmë datat}
\protect\hypertarget{shkarkojmuxeb-datat-2}{}
\includegraphics{./Figs/gzip.png}
\end{frame}

\begin{frame}[fragile]{Kontrollojmë}
\protect\hypertarget{kontrollojmuxeb}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nuts2\_df.sample(}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Përgatitja e të Dhënave}
\protect\hypertarget{puxebrgatitja-e-tuxeb-dhuxebnave}{}
\begin{itemize}
\tightlist
\item
  Duke qenë se nuk kemi të dhëna për Guyana Franceze dhe territore të
  tjera më të vogla, mund t'i heqim ato nga dataset-i.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Përgatitja e të Dhënave}
\protect\hypertarget{puxebrgatitja-e-tuxeb-dhuxebnave-1}{}
Në dataframe pandas, mund të shkruajmë kushte në mënyra të ndryshme:

\begin{itemize}
\item
  \texttt{column.str.contains(string)} kryen një përputhje të pjesshme
  në një kolonë me format tekst
\item
  \texttt{column.isin(list)} kryen një përputhje të saktë në përmbajtjen
  e një kolone ndaj një liste
\item
  \texttt{\textasciitilde{}} do të thotë ``jo'' (vetëm në kontekstin e
  pandas)
\end{itemize}
\end{frame}

\begin{frame}{Përgatitja e të Dhënave}
\protect\hypertarget{puxebrgatitja-e-tuxeb-dhuxebnave-2}{}
\begin{itemize}
\item
  Do projektojmë kufijtë dhe ti ruajmë ato në një GeoPackage.
\item
  Kini parasysh se GeoJSON lejon vetëm gjeometri në WGS84 (4326).
\item
  Kur keni një CRS tjetër, duhet të përdorni një GeoPackage.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Përgatitja e të Dhënave}
\protect\hypertarget{puxebrgatitja-e-tuxeb-dhuxebnave-3}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Kjo shprehje do të thotë:}
\CommentTok{\# zgjidhni rreshta ku NUTS\_ID nuk përmban \textquotesingle{}FRY\textquotesingle{}}
\NormalTok{nuts2\_df }\OperatorTok{=}\NormalTok{ nuts2\_df[}\OperatorTok{\textasciitilde{}}\NormalTok{nuts2\_df[}\StringTok{\textquotesingle{}NUTS\_ID\textquotesingle{}}\NormalTok{].}\BuiltInTok{str}\NormalTok{.contains(}\StringTok{"FRY"}\NormalTok{)]}

\CommentTok{\# hiqni rreshtat me kode që korrespondojnë me ishujt për të cilët nuk kemi të dhëna:}
\NormalTok{nuts2\_df }\OperatorTok{=}\NormalTok{ nuts2\_df[}\OperatorTok{\textasciitilde{}}\NormalTok{nuts2\_df[}\StringTok{\textquotesingle{}NUTS\_ID\textquotesingle{}}\NormalTok{].isin([}\StringTok{\textquotesingle{}PT20\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}PT30\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ES70\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}NO0B\textquotesingle{}}\NormalTok{])]}

\CommentTok{\# projektoni në Lambert (i përshtatshëm për Evropën)}
\NormalTok{nuts2\_df }\OperatorTok{=}\NormalTok{ nuts2\_df.to\_crs(}\DecValTok{3035}\NormalTok{)}
\NormalTok{nuts2\_df.info()}

\CommentTok{\# Ky është një rregullim: dataframe gjeo kanë nevojë që FID të jetë i tipit integer}
\NormalTok{nuts2\_df[}\StringTok{\textquotesingle{}FID\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ nuts2\_df.index}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Ruani këtë dataset në një skedar}
\protect\hypertarget{ruani-kuxebtuxeb-dataset-nuxeb-njuxeb-skedar}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nuts2\_clean\_file }\OperatorTok{=} \StringTok{"tmp/nuts2\_boundaries.gpkg"}
\NormalTok{nuts2\_df.to\_file(nuts2\_clean\_file, driver}\OperatorTok{=}\StringTok{"GPKG"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Vizatoni gjeometrinë}
\protect\hypertarget{vizatoni-gjeometrinuxeb}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nuts2\_df.plot(figsize}\OperatorTok{=}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Vizatoni gjeometrinë}
\protect\hypertarget{vizatoni-gjeometrinuxeb-1}{}
\includegraphics{./Figs/algebra1.png}
\end{frame}

\begin{frame}[fragile]{Statistikat Zonale në Python}
\protect\hypertarget{statistikat-zonale-nuxeb-python}{}
\begin{itemize}
\item
  Statistikat zonale mund të llogariten me funksionin
  \textbf{rasterstats.zonal\_stats}
\item
  Parametri \texttt{stats} tregon cilat statistika dëshirojmë të
  llogariten në çdo zonë.
\end{itemize}
\end{frame}

\begin{frame}{Statistikat Zonale në Python}
\protect\hypertarget{statistikat-zonale-nuxeb-python-1}{}
\begin{itemize}
\tightlist
\item
  Do të llogarisim disa statistika zonale dhe do ta ruajmë rezultatin në
  një GeoPackage dhe një skedar CSV:
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Statistikat Zonale në Python}
\protect\hypertarget{statistikat-zonale-nuxeb-python-2}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ rasterstats }\ImportTok{import}\NormalTok{ zonal\_stats}

\BuiltInTok{print}\NormalTok{(}\StringTok{"Duke llogaritur statistikat zonale midis"}\NormalTok{, nuts2\_clean\_file, }\StringTok{\textquotesingle{}dhe data/eu{-}2016{-}nox\_avg.tif ...\textquotesingle{}}\NormalTok{)}

\NormalTok{zon\_stats }\OperatorTok{=}\NormalTok{ zonal\_stats(nuts2\_clean\_file, }\StringTok{\textquotesingle{}data/eu{-}2016{-}nox\_avg.tif\textquotesingle{}}\NormalTok{,}
\NormalTok{                        stats}\OperatorTok{=}\StringTok{"count min mean max median"}\NormalTok{, geojson\_out}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}Përfunduar.\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Statistikat Zonale në Python}
\protect\hypertarget{statistikat-zonale-nuxeb-python-3}{}
\begin{itemize}
\item
  Rezultati është një listë e fjalorëve që përmban statistikat për çdo
  rresht të skedarit hyrës të vektorit
\item
  Këto rezultate mund të konvertohen në një kornizë të të dhënave gjeo
  kështu:
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Statistikat Zonale në Python}
\protect\hypertarget{statistikat-zonale-nuxeb-python-4}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ geopandas }\ImportTok{as}\NormalTok{ gpd}
\NormalTok{stats\_df }\OperatorTok{=}\NormalTok{ gpd.GeoDataFrame.from\_features(zon\_stats)}

\CommentTok{\# riemërtoni kolonat për të qenë më kuptimplota}
\NormalTok{stats\_df }\OperatorTok{=}\NormalTok{ stats\_df.rename(columns}\OperatorTok{=}\NormalTok{\{}\StringTok{"min"}\NormalTok{: }\StringTok{"nox\_min"}\NormalTok{,}
                                    \StringTok{"max"}\NormalTok{: }\StringTok{"nox\_max"}\NormalTok{,}
                                    \StringTok{"count"}\NormalTok{: }\StringTok{"nox\_count"}\NormalTok{,}
                                    \StringTok{"mean"}\NormalTok{: }\StringTok{"nox\_mean"}\NormalTok{,}
                                    \StringTok{"median"}\NormalTok{: }\StringTok{"nox\_median"}\NormalTok{\})}
\NormalTok{stats\_df.sample(}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Statistikat Zonale në Python}
\protect\hypertarget{statistikat-zonale-nuxeb-python-5}{}
\includegraphics{./Figs/regstat.png}
\end{frame}

\begin{frame}[fragile]{Statistikat Zonale në Python}
\protect\hypertarget{statistikat-zonale-nuxeb-python-6}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ruajmë rezultatin në një geopackage}
\NormalTok{stats\_df.to\_file(}\StringTok{\textquotesingle{}tmp/eu\_nox\_2016\_nuts2.gpkg\textquotesingle{}}\NormalTok{, driver}\OperatorTok{=}\StringTok{"GPKG"}\NormalTok{)}

\CommentTok{\# për lehtësi ruajmë tabelën e atributeve si CSV}
\NormalTok{stats\_df.drop(columns}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}geometry\textquotesingle{}}\NormalTok{]).to\_csv(}\StringTok{\textquotesingle{}tmp/eu\_nox\_2016\_nuts2.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(}\StringTok{"results saved."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve}{}
\begin{itemize}
\item
  Tani, ne mund të eksplorojmë dhe vizualizojmë rezultatet.
\item
  Funksioni \textbf{.rank()} i pandas na lejon të renditim vlerat.
\end{itemize}
\end{frame}

\begin{frame}{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-1}{}
\begin{itemize}
\item
  Shpesh është një ide e mirë të ndajmë në qeliza të ndryshme
  llogaritjet dhe vizualizimet e gjata.
\item
  Në këtë rast, nëse dëshirojmë të ekzekutojmë vizualizime të ndryshme,
  nuk kemi nevojë të rikthejmë llogaritjet zonale në qelizën e
  mëparshme.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-2}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nox\_nuts2\_df }\OperatorTok{=}\NormalTok{ gpd.read\_file(}\StringTok{\textquotesingle{}tmp/eu\_nox\_2016\_nuts2.gpkg\textquotesingle{}}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(nox\_nuts2\_df.describe())}
\BuiltInTok{print}\NormalTok{(nox\_nuts2\_df.columns)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-3}{}
\includegraphics{./Figs/eunox.png}
\end{frame}

\begin{frame}[fragile]{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-4}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Rendisni rajonet: 1 = vlera më e lartë}
\NormalTok{nox\_nuts2\_df[}\StringTok{\textquotesingle{}nox\_mean\_rank\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ nox\_nuts2\_df[}\StringTok{\textquotesingle{}nox\_mean\textquotesingle{}}\NormalTok{].rank(ascending}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{nox\_nuts2\_df[}\StringTok{\textquotesingle{}nox\_max\_rank\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ nox\_nuts2\_df[}\StringTok{\textquotesingle{}nox\_max\textquotesingle{}}\NormalTok{].rank(ascending}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-5}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# E vërtetë nëse vlera \textgreater{} 40}
\NormalTok{nox\_nuts2\_df[}\StringTok{\textquotesingle{}nox\_max\_high\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ nox\_nuts2\_df[}\StringTok{\textquotesingle{}nox\_max\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{40}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-6}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Shikoni rajonet më të ndotura NUTS, duke përzgjedhur vetëm kolonat përkatëse}
\NormalTok{sel\_df }\OperatorTok{=}\NormalTok{ nox\_nuts2\_df[[}\StringTok{\textquotesingle{}NUTS\_ID\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}NUTS\_NAME\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}nox\_mean\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}nox\_max\textquotesingle{}}\NormalTok{,}
                       \StringTok{\textquotesingle{}nox\_mean\_rank\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}nox\_max\_rank\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}nox\_max\_high\textquotesingle{}}\NormalTok{]]}
\NormalTok{sel\_df.sample(}\DecValTok{5}\NormalTok{)}

\CommentTok{\# Rendisni rajonet sipas nox\_mean}
\NormalTok{sel\_df.sort\_values(}\StringTok{\textquotesingle{}nox\_mean\textquotesingle{}}\NormalTok{,ascending}\OperatorTok{=}\VariableTok{False}\NormalTok{).head(}\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-7}{}
\includegraphics{./Figs/eunox2.png}
\end{frame}

\begin{frame}{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-8}{}
\begin{itemize}
\item
  Vini re se si renditja për \textbf{nox\_max} dhe \textbf{nox\_mean}
  mund të ndryshojë:
\item
  Për shembull, Inner London - West (``UKI3'') ka nivelin më të lartë të
  NOx në mesatare, por është vetëm i 23-ti për sa i përket vlerës
  maksimale.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-9}{}
\begin{itemize}
\tightlist
\item
  Mund të vizatojmë vlerat e grumbulluara me një choropleth:
\end{itemize}

\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nox\_nuts2\_df.plot(column}\OperatorTok{=}\StringTok{\textquotesingle{}nox\_max\textquotesingle{}}\NormalTok{, figsize}\OperatorTok{=}\NormalTok{(}\DecValTok{12}\NormalTok{,}\DecValTok{9}\NormalTok{), scheme}\OperatorTok{=}\StringTok{\textquotesingle{}equalinterval\textquotesingle{}}\NormalTok{, cmap}\OperatorTok{=}\StringTok{\textquotesingle{}OrRd\textquotesingle{}}\NormalTok{, k}\OperatorTok{=}\DecValTok{5}\NormalTok{,}
\NormalTok{    edgecolor}\OperatorTok{=}\StringTok{"lightgrey"}\NormalTok{, linewidth}\OperatorTok{=}\FloatTok{0.4}\NormalTok{,}
\NormalTok{    legend}\OperatorTok{=}\VariableTok{True}\NormalTok{, legend\_kwds}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}loc\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}upper right\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}title\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}NOx Maksimale (2016) {-} NUTS 2\textquotesingle{}}\NormalTok{\},}
\NormalTok{    missing\_kwds}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}color\textquotesingle{}}\NormalTok{: }\StringTok{"lightgrey"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-10}{}
\includegraphics{./Figs/eunox3.png}
\end{frame}

\begin{frame}{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-11}{}
\begin{itemize}
\item
  Shpërndarja e NOx është shumë heterogjene hapësinore (dmth., ndryshon
  shumë në çdo vend).
\item
  Ne mund të përdorim \textbf{groupby} për të gjetur njësinë kryesore të
  NUTS për çdo vend për sa i përket NOx maksimale:
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-12}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nox\_nuts2\_df[}\StringTok{\textquotesingle{}nox\_max\_country\_rank\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ nox\_nuts2\_df.groupby(}\StringTok{\textquotesingle{}CNTR\_CODE\textquotesingle{}}\NormalTok{)[}\StringTok{\textquotesingle{}nox\_max\textquotesingle{}}\NormalTok{].rank(ascending}\OperatorTok{=}\VariableTok{False}\NormalTok{)}

\CommentTok{\# për çdo vend, njësitë renditen në mënyrë të brendshme}
\NormalTok{sel\_df }\OperatorTok{=}\NormalTok{ nox\_nuts2\_df[[}\StringTok{\textquotesingle{}NUTS\_ID\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}NUTS\_NAME\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}nox\_max\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}nox\_max\_country\_rank\textquotesingle{}}\NormalTok{]]}
\NormalTok{sel\_df}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-13}{}
\AddToHookNext{env/Highlighting/begin}{\tiny}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Zgjidhni vetëm njësinë kryesore për çdo vend (rank==1) dhe rendisni ato sipas NOx maksimale:}
\NormalTok{top\_df }\OperatorTok{=}\NormalTok{ sel\_df[sel\_df[}\StringTok{\textquotesingle{}nox\_max\_country\_rank\textquotesingle{}}\NormalTok{]}\OperatorTok{==}\DecValTok{1}\NormalTok{]}
\NormalTok{top\_df.sort\_values(}\StringTok{\textquotesingle{}nox\_max\textquotesingle{}}\NormalTok{, ascending}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Renditja dhe Vizualizimi i Rezultateve}
\protect\hypertarget{renditja-dhe-vizualizimi-i-rezultateve-14}{}
\includegraphics{./Figs/eunox4.png}
\end{frame}

\end{document}
